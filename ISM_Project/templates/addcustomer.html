{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
<link rel="stylesheet" href="{% static 'css/addcustomer.css' %}">
{% endblock %}

{% block content %}
<div class="wrapper">
  <!-- Sidebar -->
  {% include 'sidebar.html' %}
  
  <!-- Main Component -->
  <div class="main">
    <main class="content px-2 py-5">
      <div class="container-fluid">
        <div class="mb-3">
          <h3>Customers List</h3>
        </div>
        <div class="d-flex justify-content-end mb-3">
          <button id="addCustomerBtn" class="btn btn-success me-5">
            ADD NEW CUSTOMER 
          </button>
        </div>
        
        <!-- Customers Table -->
        <div class="customers-table-container table-responsive-xxl">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Tier</th>
              </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Alice Smith</td>
                    <td>alice@abc.com</td>
                    <td>123-456-7890</td>
                    <td>Hue City, VN</td>
                    <td>Gold</td>
                    <td>
                        <a href="#" class="btn btn-sm btn-outline-success" title="Edit">
                            <i class='bx bx-edit-alt'></i>
                        </a>
                        <a href="#" class="btn btn-sm btn-outline-danger" title="Delete">
                            <i class='bx bx-trash'></i>
                        </a>
                    </td>
                </tr>
              {% for customer in customers %}
              <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.email }}</td>
                <td>{{ customer.phone }}</td>
                <td>{{ customer.address }}</td>
                <td>{{ customer.tier }}</td>
                <td>
                  <a 
                    href="{% url 'update_customer' customer.id %}" 
                    class="btn btn-sm btn-outline-success" 
                    title="Edit"
                  >
                    <i class='bx bx-edit-alt'></i>
                  </a>
                  <a 
                    href="{% url 'delete_customer' customer.id %}" 
                    class="btn btn-sm btn-outline-danger"
                    title="Delete"
                  >
                    <i class='bx bx-trash'></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7">No customers found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>
  
  <!-- New Customer Modal -->
    <div id="newCustomerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>New Customer</h2>
            <form id="newCustomerForm">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" id="name" name="name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="example@gmail.com" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" id="phone" name="phone" placeholder="(111) 222-3333" required>
                </div>
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" name="address" placeholder="ABC Street" required>
                </div>
                <div class="form-group">
                    <label for="tier">Tier</label>
                    <select id="tier" name="tier" required>
                        <option value="">Select Tier</option>
                        <option value="Bronze">Bronze</option>
                        <option value="Silver">Silver</option>
                        <option value="Gold">Gold</option>
                        <option value="Platinum">Platinum</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">SUBMIT</button>
            </form>
        </div>
    </div>

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const addCustomerBtn = document.getElementById('addCustomerBtn');
            const newCustomerModal = document.getElementById('newCustomerModal');
            const closeBtn = document.querySelector('.close-btn');
            const newCustomerForm = document.getElementById('newCustomerForm');
            const customerTableBody = document.querySelector('.table tbody');
            let customerIdCounter = 2; // Start from 2 since we have Alice Smith as ID 1

            // Open modal
            addCustomerBtn.addEventListener('click', function() {
                newCustomerModal.style.display = 'flex';
            });

            // Close modal
            closeBtn.addEventListener('click', function() {
                newCustomerModal.style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === newCustomerModal) {
                    newCustomerModal.style.display = 'none';
                }
            });

            // Form submission
            newCustomerForm.addEventListener('submit', function(event) {
                event.preventDefault();

                // Get form values
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const address = document.getElementById('address').value;
                const tier = document.getElementById('tier').value;

                // Create new table row
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${customerIdCounter}</td>
                    <td>${name}</td>
                    <td>${email}</td>
                    <td>${phone}</td>
                    <td>${address}</td>
                    <td>${tier}</td>
                    <td>
                        <a href="#" class="btn btn-sm btn-outline-success" title="Edit">
                            <i class='bx bx-edit-alt'></i>
                        </a>
                        <a href="#" class="btn btn-sm btn-outline-danger" title="Delete">
                            <i class='bx bx-trash'></i>
                        </a>
                    </td>
                `;

                // Add event listener for delete button
                const deleteBtn = newRow.querySelector('.btn-outline-danger');
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    newRow.remove();
                });

                // Add row to table
                customerTableBody.appendChild(newRow);

                // Increment customer ID counter
                customerIdCounter++;

                // Reset form and close modal
                newCustomerForm.reset();
                newCustomerModal.style.display = 'none';
            });

            // Add delete functionality to existing delete buttons
            document.querySelectorAll('.btn-outline-danger').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    this.closest('tr').remove();
                });
            });
        });
    </script>
{% endblock %}
{% endblock %}